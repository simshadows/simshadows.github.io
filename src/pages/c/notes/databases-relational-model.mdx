---
layout: "@layouts/MDLayout.astro"
title: "Databases: The Relational Model and Relational Algebra"
description: A cheatsheet for the relational model and relational algebra, in the context of relational databases and SQL.
keywords: ["programming", "databases", "relational", "sql"]
---

import Fig from "@components/figures/Fig";
import FigImg from "@components/figures/FigImg";
import FiguresBlock from "@components/figures/FiguresBlock";
import FiguresGroupVertical from "@components/figures/FiguresGroupVertical";

import AlignLatex from "@components/latex/AlignLatex";
import Eq from "@components/latex/Eq";
import Trl from "@components/latex/TableRowLatex";
import Trhl from "@components/latex/TableRowHLatex";

import Eqref from "@components/latex/Eqref";
import Todo from "@components/Todo";
import ExampleFrame from "@components/ExampleFrame";

import SimpleVennIntersection from "@img_latex/simplevenn-intersection.svg";
import SimpleVennLeft from "@img_latex/simplevenn-left.svg";
import SimpleVennRight from "@img_latex/simplevenn-right.svg";
import SimpleVennUnion from "@img_latex/simplevenn-union.svg";

import RelationInstanceLabelled from "./_databases-relational-model.images/generated-do-not-edit/relation-instance-labelled.svg"; //_

import "./_databases-relational-model.css"; //_

## Basic Terms

### Relation Schemas

Relation schemas are <u>finite sets</u> of *attributes*.

Notation for some relation <Eq code="R" /> with attributes <Eq code="A, B, C, D" /> and primary key <Eq code="B, D" />:

```latex-eq
R(A, \underline{B}, C, \underline{D})
```

The *domain* of a schema is the set of all possible tuples that can be associated with the schema.

For relation <Eq code="R" />, this is denoted:

```latex-eq
\dom{(R)}
```


### Keys

A *<u>superkey</u>* of a relation schema is any subset of that schema that can uniquely identify a tuple.

In other words, all tuples have unique values in the superkey.

Or more formally, for <Eq code="r(R)" /> and any two distinct tuples <Eq code="t_1, t_2 \in r" />, if <Eq code="t_1[K] \neq t_2[K]" /> for some <Eq code="K \subseteq R" />, then <Eq code="K" /> is a superkey.

Note that for <Eq code="r(R)" />, <Eq code="R" /> is always a superkey.

<br />A *<u>candidate key</u>* is a "minimal superkey".

More formally, superkey <Eq code="K" /> is a candidate key if no subset <Eq code="K' \subset K" /> exists that is also a superkey.

<br />A *<u>primary key</u>* is the specific candidate key designated to a relation schema.

All relations must have exactly one primary key.

<br />A *<u>foreign key</u>* of a relation schema is a subset of attributes that reference a particular primary key.

The referenced primary key is often a different relation, but may also be of the same relation.


### Attributes

Attributes are labels for parts of a schema.

The *domain* of an attribute is the set of values that can be associated with the attribute.

For attribute <Eq code="A" />, this is denoted:

```latex-eq
\dom{(A)}
```


### Relation Instances

Relation instances are <u>finite sets</u> of *tuples*.

To show that <Eq code="r" /> is an instance of schema <Eq code="R" />, we write:

```latex-eq
r(R)
```

<ExampleFrame>
    <FiguresBlock>
        <FigImg
            src={RelationInstanceLabelled}
            alt="A venn diagram representing the inner/theta join."
        />
    </FiguresBlock>
</ExampleFrame>


### Tuples

Tuples are <u>mappings</u> from schema to schema domain.

Concretely, a tuple can be thought of as a set of attribute-value pairs.

We will use the following notation in this cheatsheet:

<ul class="no-deco">
    <li>
        <Eq code="t[X]" /> extracts attribute set <Eq code="X" />.<br />
        <Eq code="t[X]" /> is itself a tuple.
    </li>
    <li>
        <Eq code="t[A]" /> extracts a single attribute <Eq code="A" />.<br />
        <Eq code="t[A]" /> is a value. *(Yes, I know this is confusing.)*
    </li>
    <li>
        <Eq code="(t_r : t_s)" /> combines tuples <Eq code="t_r" /> and <Eq code="t_s" />.<br />
        <Eq code="(t_r : t_s)" /> is itself a tuple.
    </li>
</ul>


### The Null Value (Extended RA)

The null value is a special value that may be part of an attribute domain.

We will use the symbol <Eq code="\relnullvalue" /> to represent *null* in this cheatsheet.

While the null value is an important part of the relational model, <u>it is not a core part of relational algebra</u>.


## Operators

### Selection

Produces the subset of tuples that satisfy a condition.

For <Eq code="r(R)" /> and selection condition <Eq code="c" />:

```latex-eq
\relselect_{c}{(r)} = \setdef{t \in r}{c(t)}
```

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="3"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "2", "x"]} />
                    <Trl rows={["a_2", "8", "x"]} />
                    <Trl rows={["a_3", "7", "x"]} />
                    <Trl rows={["a_4", "9", "y"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="3"><Eq code="\relselect_{(B>5) \wedge (C=x)}{(r)}" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_2", "8", "x"]} />
                    <Trl rows={["a_3", "7", "x"]} />
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Projection

Produces a relation with a subset of attributes.

For <Eq code="r(R)" /> and attribute set <Eq code="X" />:

```latex-eq
\relproject_{X}{(r)} = \setdef{t[X]}{t \in r}
```

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "b_1", "c_1", "d_1"]} />
                    <Trl rows={["a_2", "b_2", "c_2", "d_2"]} />
                    <Trl rows={["a_3", "b_3", "c_3", "d_3"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="2"><Eq code="\relproject_{B, D}{(r)}" /></th>
                    </tr>
                    <Trhl rows={["B", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["b_1", "d_1"]} />
                    <Trl rows={["b_2", "d_2"]} />
                    <Trl rows={["b_3", "d_3"]} />
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Rename

Casts a relation to a different schema.

For <Eq code="r(R)" /> and a compatible schema <Eq code="S" />:

```latex-eq
\relrename_{S}{(r)}
```

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "b_1", "c_1"]} />
                    <Trl rows={["a_2", "b_2", "c_2"]} />
                    <Trl rows={["a_3", "b_3", "c_3"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="\relrename_{S(D, E, F)}{(r)}" /></th>
                    </tr>
                    <Trhl rows={["D", "E", "F"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "b_1", "c_1"]} />
                    <Trl rows={["a_2", "b_2", "c_2"]} />
                    <Trl rows={["a_3", "b_3", "c_3"]} />
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Union, Intersection, and Difference

Set theoretic operations between *union-compatible* relations (i.e. same schema).

For <Eq code="r_1(R)" /> and <Eq code="r_2(R)" />:

```latex-align
r_1 \cup r_2 &= \setdef{t}{(t \in r_1) \vee   (t \in r_2)} \\
r_1 \cap r_2 &= \setdef{t}{(t \in r_1) \wedge (t \in r_2)} \\
r_1 - r_2    &= \setdef{t}{(t \in r_1) \wedge (t \notin r_2)}
```

<ExampleFrame>
    <FiguresBlock>
        <FiguresGroupVertical>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r_1" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "C"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <tr class="red">
                            <td><Eq code="\bm{a_1}" /></td>
                            <td><Eq code="\bm{b_1}" /></td>
                            <td><Eq code="\bm{c_1}" /></td>
                        </tr>
                        <tr class="red">
                            <td><Eq code="\bm{a_2}" /></td>
                            <td><Eq code="\bm{b_2}" /></td>
                            <td><Eq code="\bm{c_2}" /></td>
                        </tr>
                        <tr class="red">
                            <td><Eq code="\bm{a_3}" /></td>
                            <td><Eq code="\bm{b_3}" /></td>
                            <td><Eq code="\bm{c_3}" /></td>
                        </tr>
                        <tr class="purple">
                            <td><Eq code="\bm{a_4}" /></td>
                            <td><Eq code="\bm{b_4}" /></td>
                            <td><Eq code="\bm{c_4}" /></td>
                        </tr>
                        <tr class="purple">
                            <td><Eq code="\bm{a_5}" /></td>
                            <td><Eq code="\bm{b_5}" /></td>
                            <td><Eq code="\bm{c_5}" /></td>
                        </tr>
                    </tbody>
                </table>
            </Fig>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r_2" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "C"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <tr class="purple">
                            <td><Eq code="\bm{a_4}" /></td>
                            <td><Eq code="\bm{b_4}" /></td>
                            <td><Eq code="\bm{c_4}" /></td>
                        </tr>
                        <tr class="purple">
                            <td><Eq code="\bm{a_5}" /></td>
                            <td><Eq code="\bm{b_5}" /></td>
                            <td><Eq code="\bm{c_5}" /></td>
                        </tr>
                        <tr class="blue">
                            <td><Eq code="\bm{a_6}" /></td>
                            <td><Eq code="\bm{b_6}" /></td>
                            <td><Eq code="\bm{c_6}" /></td>
                        </tr>
                        <tr class="blue">
                            <td><Eq code="\bm{a_7}" /></td>
                            <td><Eq code="\bm{b_7}" /></td>
                            <td><Eq code="\bm{c_7}" /></td>
                        </tr>
                    </tbody>
                </table>
            </Fig>
        </FiguresGroupVertical>
        <FiguresGroupVertical>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r_1 \cup r_2" /></th>
                        </tr>
                        <tr>
                            <th><Eq code="A" /></th>
                            <th><Eq code="B" /></th>
                            <th><Eq code="C" /></th>
                        </tr>
                    </thead>
                    <tbody class="table-bordered">
                        <tr class="red">
                            <td><Eq code="\bm{a_1}" /></td>
                            <td><Eq code="\bm{b_1}" /></td>
                            <td><Eq code="\bm{c_1}" /></td>
                        </tr>
                        <tr class="red">
                            <td><Eq code="\bm{a_2}" /></td>
                            <td><Eq code="\bm{b_2}" /></td>
                            <td><Eq code="\bm{c_2}" /></td>
                        </tr>
                        <tr class="red">
                            <td><Eq code="\bm{a_3}" /></td>
                            <td><Eq code="\bm{b_3}" /></td>
                            <td><Eq code="\bm{c_3}" /></td>
                        </tr>
                        <tr class="purple">
                            <td><Eq code="\bm{a_4}" /></td>
                            <td><Eq code="\bm{b_4}" /></td>
                            <td><Eq code="\bm{c_4}" /></td>
                        </tr>
                        <tr class="purple">
                            <td><Eq code="\bm{a_5}" /></td>
                            <td><Eq code="\bm{b_5}" /></td>
                            <td><Eq code="\bm{c_5}" /></td>
                        </tr>
                        <tr class="blue">
                            <td><Eq code="\bm{a_6}" /></td>
                            <td><Eq code="\bm{b_6}" /></td>
                            <td><Eq code="\bm{c_6}" /></td>
                        </tr>
                        <tr class="blue">
                            <td><Eq code="\bm{a_7}" /></td>
                            <td><Eq code="\bm{b_7}" /></td>
                            <td><Eq code="\bm{c_7}" /></td>
                        </tr>
                    </tbody>
                </table>
            </Fig>
        </FiguresGroupVertical>
        <FiguresGroupVertical>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r_1 - r_2" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "C"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <tr class="red">
                            <td><Eq code="\bm{a_1}" /></td>
                            <td><Eq code="\bm{b_1}" /></td>
                            <td><Eq code="\bm{c_1}" /></td>
                        </tr>
                        <tr class="red">
                            <td><Eq code="\bm{a_2}" /></td>
                            <td><Eq code="\bm{b_2}" /></td>
                            <td><Eq code="\bm{c_2}" /></td>
                        </tr>
                        <tr class="red">
                            <td><Eq code="\bm{a_3}" /></td>
                            <td><Eq code="\bm{b_3}" /></td>
                            <td><Eq code="\bm{c_3}" /></td>
                        </tr>
                    </tbody>
                </table>
            </Fig>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r_1 \cap r_2" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "C"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <tr class="purple">
                            <td><Eq code="\bm{a_4}" /></td>
                            <td><Eq code="\bm{b_4}" /></td>
                            <td><Eq code="\bm{c_4}" /></td>
                        </tr>
                        <tr class="purple">
                            <td><Eq code="\bm{a_5}" /></td>
                            <td><Eq code="\bm{b_5}" /></td>
                            <td><Eq code="\bm{c_5}" /></td>
                        </tr>
                    </tbody>
                </table>
            </Fig>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r_2 - r_1" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "C"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <tr class="blue">
                            <td><Eq code="\bm{a_6}" /></td>
                            <td><Eq code="\bm{b_6}" /></td>
                            <td><Eq code="\bm{c_6}" /></td>
                        </tr>
                        <tr class="blue">
                            <td><Eq code="\bm{a_7}" /></td>
                            <td><Eq code="\bm{b_7}" /></td>
                            <td><Eq code="\bm{c_7}" /></td>
                        </tr>
                    </tbody>
                </table>
            </Fig>
        </FiguresGroupVertical>
    </FiguresBlock>
</ExampleFrame>


### Cartesian Product

Produces every possible combination of tuples from two relations.

For <Eq code="r(R)" /> and <Eq code="s(S)" />:

```latex-eq
r \times s = \setdef{(t_r:t_s)}{(t_r \in r) \wedge (t_s \in s)}
```

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="3"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "b_1", "c_1"]} />
                    <Trl rows={["a_2", "b_2", "c_2"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="2"><Eq code="s" /></th>
                    </tr>
                    <Trhl rows={["M", "N"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["m_1", "n_1"]} />
                    <Trl rows={["m_2", "n_2"]} />
                    <Trl rows={["m_3", "n_3"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="5"><Eq code="r \times s" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "M", "N"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "b_1", "c_1", "m_1", "n_1"]} />
                    <Trl rows={["a_1", "b_1", "c_1", "m_2", "n_2"]} />
                    <Trl rows={["a_1", "b_1", "c_1", "m_3", "n_3"]} />
                    <Trl rows={["a_2", "b_2", "c_2", "m_1", "n_1"]} />
                    <Trl rows={["a_2", "b_2", "c_2", "m_2", "n_2"]} />
                    <Trl rows={["a_2", "b_2", "c_2", "m_3", "n_3"]} />
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Theta/Inner Join and Equijoin

*<u>Theta join</u>* combines the tuples of two relations using a matching criterion.

For <Eq code="r(R)" /> and <Eq code="s(S)" />, and some arbitrary matching criterion <Eq code="c" />:

```latex-eq
r \bowtie_c s
= \setdef{
    (t_r : t_s)
}{
    (t_r \in r) \wedge (t_s \in s) \wedge c(t_r : t_s)
}
```

Theta join can also be defined as:

```latex-eq
r \bowtie_c s = \relselect_{c(r, s)}{\parens{r \times s}}
```

Duplicate attributes are not removed.

*<u>Equijoin</u>* is a special case of theta join that only tests for equality between attributes.

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="3"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "b_1", "0"]} />
                    <Trl rows={["a_2", "b_2", "3"]} />
                    <Trl rows={["a_3", "b_3", "2"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="2"><Eq code="s" /></th>
                    </tr>
                    <Trhl rows={["M", "N"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["m_1", "3"]} />
                    <Trl rows={["m_2", "4"]} />
                    <Trl rows={["m_3", "1"]} />
                    <Trl rows={["m_4", "2"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="5"><Eq code="r \bowtie_{N \le C} s" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "M", "N"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_2", "b_2", "3", "m_1", "3"]} />
                    <Trl rows={["a_2", "b_2", "3", "m_3", "1"]} />
                    <Trl rows={["a_2", "b_2", "3", "m_4", "2"]} />
                    <Trl rows={["a_3", "b_3", "2", "m_3", "1"]} />
                    <Trl rows={["a_3", "b_3", "2", "m_4", "2"]} />
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Natural Join

A special case of *equijoin* that matches tuples on all their common attributes.

For <Eq code="r(R)" /> and <Eq code="s(S)" />:

```latex-eq
r \bowtie s
= \setdef{
    \parens{t_r : t_s[S - R]}
}{
    (t_r \in r) \wedge (t_s \in s) \wedge m(t_r, t_s)
}
```

where <Eq code="m" /> is "all common attributes must match":

```latex-eq
m(t_r, t_s) = \parens{\vphantom{\frac{x}{x}} t_r[R \cap S] = t_s[R \cap S]}
```

Natural join can also be defined as:

```latex-eq
r \bowtie s
= \relproject_{R \cup S}{\parens{\relselect_{m(r, s)}{\parens{r \times s}}}}
```

where <Eq code="m" /> is:

```latex-eq
m(r, s)
= \parens{\vphantom{\frac{x}{x}} r[R \cap S] = s[R \cap S]}
```

and <Eq code="\relproject_{R \cup S}" /> assumes removal of duplicate attributes.

<p><span class="warning">*Natural join* is dangerous in real applications. Use *equijoin* to explicitly match tuples instead.</span></p>

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="a_1" /></td>
                        <td><Eq code="b_1" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="x" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_2" /></td>
                        <td><Eq code="b_2" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_3" /></td>
                        <td><Eq code="b_3" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_4" /></td>
                        <td><Eq code="b_4" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="3"><Eq code="s" /></th>
                    </tr>
                    <Trhl rows={["C", "D", "E"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="y" /></td>
                        <td><Eq code="y" /></td>
                        <td><Eq code="e_1" /></td>
                    </tr>
                    <tr>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                        <td><Eq code="e_2" /></td>
                    </tr>
                    <tr>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                        <td><Eq code="e_3" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="5"><Eq code="r \bowtie s" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D", "E"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="a_2" /></td>
                        <td><Eq code="b_2" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                        <td><Eq code="e_2" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_3" /></td>
                        <td><Eq code="b_3" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                        <td><Eq code="e_2" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_4" /></td>
                        <td><Eq code="b_4" /></td>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                        <td><Eq code="e_3" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Division (Extended RA)

For <Eq code="r(R)" /> and <Eq code="s(S)" />, with <Eq code="S \subseteq R" />:

```latex-eq
r \div s = \setdef{t \in \relproject_{R-S}{(r)}}{\Phi(t)}
```

where:

```latex-eq
\newcommand{\X}{\rule[-2ex]{0mm}{2ex}}
\Phi(t) =
    \underbrace{\X \forall t_s \in s}_{(1)}
    \, \underbrace{\X \exists t_r \in r}_{(2)}
    \, (
        \underbrace{\X t_r[S] = t_s}_{(3)}
        \underbrace{\X \wedge t = t_r[R-S]}_{(4)}
    )
```

*In plain English:* (1) For all tuples in <Eq code="s" />, (2) there is at least one relation in <Eq code="r" /> (3) whose common attributes match, (4) and whose non-common attributes are the same.

Division can also be defined as:

```latex-eq
r \div s =
    r' -
    \underbrace{ \rule[-2ex]{0mm}{2ex}
        \relproject_{(R-S)}{\parens{\vphantom{\frac{x}{x}} [r' \times s] - r}}
    }_{\text{``disqualifier'' term}}
```

where <Eq code="r'" /> is "all possible result tuples":

```latex-eq
r' = \relproject_{(R-S)}{(r)}
```

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="\alpha" /></td>
                        <td><Eq code="\beta" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="x" /></td>
                    </tr>
                    <tr class="blue">
                        <td><Eq code="\bm{\alpha}" /></td>
                        <td><Eq code="\bm{\beta}" /></td>
                        <td><Eq code="\bm{x}" /></td>
                        <td><Eq code="\bm{z}" /></td>
                    </tr>
                    <tr class="blue">
                        <td><Eq code="\bm{\alpha}" /></td>
                        <td><Eq code="\bm{\beta}" /></td>
                        <td><Eq code="\bm{w}" /></td>
                        <td><Eq code="\bm{z}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="\gamma" /></td>
                        <td><Eq code="\delta" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="x" /></td>
                    </tr>
                    <tr class="red">
                        <td><Eq code="\bm{\gamma}" /></td>
                        <td><Eq code="\bm{\delta}" /></td>
                        <td><Eq code="\bm{x}" /></td>
                        <td><Eq code="\bm{y}" /></td>
                    </tr>
                    <tr class="red">
                        <td><Eq code="\bm{\gamma}" /></td>
                        <td><Eq code="\bm{\delta}" /></td>
                        <td><Eq code="\bm{x}" /></td>
                        <td><Eq code="\bm{z}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="\gamma" /></td>
                        <td><Eq code="\delta" /></td>
                        <td><Eq code="w" /></td>
                        <td><Eq code="x" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="\gamma" /></td>
                        <td><Eq code="\delta" /></td>
                        <td><Eq code="w" /></td>
                        <td><Eq code="y" /></td>
                    </tr>
                    <tr class="red">
                        <td><Eq code="\bm{\gamma}" /></td>
                        <td><Eq code="\bm{\delta}" /></td>
                        <td><Eq code="\bm{w}" /></td>
                        <td><Eq code="\bm{z}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="\gamma" /></td>
                        <td><Eq code="\delta" /></td>
                        <td><Eq code="w" /></td>
                        <td><Eq code="w" /></td>
                    </tr>
                    <tr class="blue">
                        <td><Eq code="\bm{\epsilon}" /></td>
                        <td><Eq code="\bm{\zeta}" /></td>
                        <td><Eq code="\bm{x}" /></td>
                        <td><Eq code="\bm{y}" /></td>
                    </tr>
                    <tr class="blue">
                        <td><Eq code="\bm{\epsilon}" /></td>
                        <td><Eq code="\bm{\zeta}" /></td>
                        <td><Eq code="\bm{x}" /></td>
                        <td><Eq code="\bm{z}" /></td>
                    </tr>
                    <tr class="blue">
                        <td><Eq code="\bm{\epsilon}" /></td>
                        <td><Eq code="\bm{\zeta}" /></td>
                        <td><Eq code="\bm{w}" /></td>
                        <td><Eq code="\bm{z}" /></td>
                    </tr>
                    <tr class="red">
                        <td><Eq code="\bm{\eta}" /></td>
                        <td><Eq code="\bm{\theta}" /></td>
                        <td><Eq code="\bm{x}" /></td>
                        <td><Eq code="\bm{y}" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="2"><Eq code="s" /></th>
                    </tr>
                    <Trhl rows={["C", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="x" /></td>
                        <td><Eq code="y" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="x" /></td>
                        <td><Eq code="z" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="w" /></td>
                        <td><Eq code="z" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="2"><Eq code="r \div s" /></th>
                    </tr>
                    <Trhl rows={["A", "B"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="\gamma" /></td>
                        <td><Eq code="\delta" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="\epsilon" /></td>
                        <td><Eq code="\zeta" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>

    In <Eq code="r" />, values <Eq code="(\gamma, \delta)" /> and <Eq code="(\epsilon, \zeta)" /> are the only values that occur with all values <Eq code="(x, y)" />, <Eq code="(x, z)" />, and <Eq code="(w, z)" />.
</ExampleFrame>


### Outer Join (Extended RA)

Similar to *theta join*, except in the result relation, we also include tuples that don't have matches in the join.

These unmatched tuples get padded with null values in the result relation.

*<u>Full outer join</u>* includes all tuples of both operands:

<AlignLatex code="
    r \relfullouterjoinSubscripted_c\, s &=
        (r \bowtie_c s)
        \cup \parens{\vphantom{\frac{x}{x}}
            \parens{r - \relproject_R{(r \bowtie_c s)}}
            \times \braces{(\relnullvalue, \dots)}
        } \\
    &
        \qquad
        \cup \parens{\vphantom{\frac{x}{x}}
            \parens{r - \relproject_R{(r \bowtie_c s)}}
            \times \braces{(\relnullvalue, \dots)}
        } \\
    &= (r \relleftouterjoinSubscripted_c\, s) \cup (r \relrightouterjoinSubscripted_c\, s)
" />

*<u>Left outer join</u>* includes all tuples of the left:

<AlignLatex code="
    r \relleftouterjoinSubscripted_c\, s &=
        (r \bowtie_c s)
        \cup \parens{\vphantom{\frac{x}{x}}
            \parens{r - \relproject_R{(r \bowtie_c s)}}
            \times \braces{(\relnullvalue, \dots)}
        } \\
    &=
        s \relrightouterjoinSubscripted_c\, r
" />

*<u>Right outer join</u>* includes all tuples of the right:

<AlignLatex code="
    r \relrightouterjoinSubscripted_c\, s &=
        (r \bowtie_c s)
        \cup \parens{\vphantom{\frac{x}{x}}
            \parens{s - \relproject_S{(r \bowtie_c s)}}
            \times \braces{(\relnullvalue, \dots)}
        } \\
    &=
        s \relleftouterjoinSubscripted_c\, r
" />

To summarize the differences between the joins:

<p><FiguresBlock>
    <FigImg src={SimpleVennIntersection} alt="A venn diagram representing the inner/theta join.">
        Inner/Theta
    </FigImg>
    <FigImg src={SimpleVennLeft} alt="A venn diagram representing the left outer join.">
        Left Outer
    </FigImg>
    <FigImg src={SimpleVennRight} alt="A venn diagram representing the right outer join.">
        Right Outer
    </FigImg>
    <FigImg src={SimpleVennUnion} alt="A venn diagram representing the full outer join.">
        Full Outer
    </FigImg>
</FiguresBlock></p>

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="a_1" /></td>
                        <td><Eq code="b_1" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="x" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_2" /></td>
                        <td><Eq code="b_2" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_3" /></td>
                        <td><Eq code="b_3" /></td>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_4" /></td>
                        <td><Eq code="b_4" /></td>
                        <td><Eq code="z" /></td>
                        <td><Eq code="w" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="3"><Eq code="s" /></th>
                    </tr>
                    <Trhl rows={["C", "D", "E"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="y" /></td>
                        <td><Eq code="y" /></td>
                        <td><Eq code="e_1" /></td>
                    </tr>
                    <tr>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                        <td><Eq code="e_2" /></td>
                    </tr>
                    <tr>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                        <td><Eq code="e_3" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="5"><Eq code="r \relfullouterjoin s" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D", "E"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="a_1" /></td>
                        <td><Eq code="b_1" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="\relnullvalue" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_2" /></td>
                        <td><Eq code="b_2" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                        <td><Eq code="e_2" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_3" /></td>
                        <td><Eq code="b_3" /></td>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                        <td><Eq code="e_3" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_4" /></td>
                        <td><Eq code="b_4" /></td>
                        <td><Eq code="z" /></td>
                        <td><Eq code="w" /></td>
                        <td><Eq code="\relnullvalue" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="\relnullvalue" /></td>
                        <td><Eq code="\relnullvalue" /></td>
                        <td><Eq code="y" /></td>
                        <td><Eq code="y" /></td>
                        <td><Eq code="e_1" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="5"><Eq code="r \relleftouterjoin s" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D", "E"]} />
                </thead>
                <tbody class="table-bordered">
                    <tr>
                        <td><Eq code="a_1" /></td>
                        <td><Eq code="b_1" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="x" /></td>
                        <td><Eq code="\relnullvalue" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_2" /></td>
                        <td><Eq code="b_2" /></td>
                        <td class="red"><Eq code="\bm{x}" /></td>
                        <td class="red"><Eq code="\bm{y}" /></td>
                        <td><Eq code="e_2" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_3" /></td>
                        <td><Eq code="b_3" /></td>
                        <td class="blue"><Eq code="\bm{y}" /></td>
                        <td class="blue"><Eq code="\bm{x}" /></td>
                        <td><Eq code="e_3" /></td>
                    </tr>
                    <tr>
                        <td><Eq code="a_4" /></td>
                        <td><Eq code="b_4" /></td>
                        <td><Eq code="z" /></td>
                        <td><Eq code="w" /></td>
                        <td><Eq code="\relnullvalue" /></td>
                    </tr>
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


### Grouping Operator (Extended RA)

Performs calculations over groups of tuples within a relation. Produces a relation containing the results.

For <Eq code="r(R)" /> and operator subscript <Eq code="G" />:

```latex-eq
\relgroup_G{(R)}
```

where <Eq code="G" /> is a list containing:

- one or more attributes from <Eq code="R" /> to be taken as *grouping attributes*, and
- one or more *aggregate functions*, written in the form <Eq code="\theta{(A, \dots)}" />, where <Eq code="\theta" /> is an aggregate function to be applied to attributes <Eq code="A, \dots" />.

Formally, aggregate functions can be considered to take a multiset (i.e. a set with duplicates) of values.

Aggregate functions defined in SQL-92:

<p class="center">AVG, MAX, MIN, SUM, COUNT</p>

Most major DBMS implementations offer many more aggregate functions and allow user-defined functions.

<ExampleFrame>
    <FiguresBlock>
        <FiguresGroupVertical>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="r" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "C", "D"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <Trl rows={["x", "\\alpha", "5", "7"]} />
                        <Trl rows={["x", "\\alpha", "7", "3"]} />
                        <Trl rows={["x", "\\beta ", "1", "9"]} />
                        <Trl rows={["x", "\\beta ", "5", "6"]} />
                        <Trl rows={["y", "\\alpha", "3", "1"]} />
                        <Trl rows={["y", "\\alpha", "2", "1"]} />
                        <Trl rows={["y", "\\beta ", "3", "5"]} />
                        <Trl rows={["z", "\\alpha", "9", "4"]} />
                    </tbody>
                </table>
            </Fig>
        </FiguresGroupVertical>
        <FiguresGroupVertical>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="\relgroup_{A, \text{COUNT}(A), \text{MAX}(C), \text{MAX}(D)}{(r)}" /></th>
                        </tr>
                        <Trhl rows={["A", "\\text{COUNT}(A)", "\\text{MAX}(C)", "\\text{MAX}(D)"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <Trl rows={["x", "4", "7", "9"]} />
                        <Trl rows={["y", "3", "3", "5"]} />
                        <Trl rows={["z", "1", "9", "4"]} />
                    </tbody>
                </table>
            </Fig>
            <Fig>
                <table class="relation-table">
                    <thead>
                        <tr class="table-label">
                            <th colspan="4"><Eq code="\relgroup_{A, B, \text{COUNT}(A), \text{SUM}(C)}{(r)}" /></th>
                        </tr>
                        <Trhl rows={["A", "B", "\\text{COUNT}(A)", "\\text{SUM}(C)"]} />
                    </thead>
                    <tbody class="table-bordered">
                        <Trl rows={["x", "\\alpha", "2", "12"]} />
                        <Trl rows={["x", "\\beta ", "2", " 6"]} />
                        <Trl rows={["y", "\\alpha", "2", " 5"]} />
                        <Trl rows={["y", "\\beta ", "1", " 3"]} />
                        <Trl rows={["z", "\\alpha", "1", " 9"]} />
                    </tbody>
                </table>
            </Fig>
        </FiguresGroupVertical>
    </FiguresBlock>

    The <Eq code="\text{COUNT}()" /> function is interesting in that it doesn't really matter which column you use.
</ExampleFrame>


### Generalized Projection (Extended RA)

We can extend the projection operator <Eq code="\pi" /> to also contain expressions for computation.

<ExampleFrame>
    <FiguresBlock>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="4"><Eq code="r" /></th>
                    </tr>
                    <Trhl rows={["A", "B", "C", "D"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", "2", "6", "d_1"]} />
                    <Trl rows={["a_2", "8", "9", "d_2"]} />
                    <Trl rows={["a_3", "3", "2", "d_3"]} />
                </tbody>
            </table>
        </Fig>
        <Fig>
            <table class="relation-table">
                <thead>
                    <tr class="table-label">
                        <th colspan="2"><Eq code="\relproject_{A, B + C}{(r)}" /></th>
                    </tr>
                    <Trhl rows={["\\phantom{A}A\\phantom{A}", "B + C"]} />
                </thead>
                <tbody class="table-bordered">
                    <Trl rows={["a_1", " 8"]} />
                    <Trl rows={["a_2", "17"]} />
                    <Trl rows={["a_3", " 5"]} />
                </tbody>
            </table>
        </Fig>
    </FiguresBlock>
</ExampleFrame>


## Further Concepts

### Functional Dependencies

<p><Todo>Write about this!</Todo></p>

